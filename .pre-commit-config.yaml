repos:
  # -------------------------------
  # Format / Lint / Text hygiene
  # -------------------------------
  - repo: local
    hooks:
      - id: black-local
        name: black (.venv311)
        language: system
        entry: .venv311\Scripts\python.exe -m black
        types_or: [python]
        exclude: ^(src/data/|build/|data/|updates_zip/|site/|docs/|\.ruff_cache/|\.precommit_cache/)

      - id: ruff-local
        name: ruff (.venv311)
        language: system
        entry: .venv311\Scripts\python.exe -m ruff
        args:
          [
            "check",
            "--no-cache",
            "--fix",
            "--exit-non-zero-on-fix",
            "--extend-exclude",
            "\\.bak$|\\.(yml|yaml)$|build/|data/|updates_zip/|site/|docs/|\\.ruff_cache/|\\.precommit_cache/",
          ]
        types_or: [python]
        files: ^(src/|tests/)
        exclude: ^(src/data/|build/|data/|updates_zip/|site/|docs/|\.ruff_cache/|\.precommit_cache/)

  # -------------------------------
  # Writers / Auditors
  # -------------------------------
  - repo: local
    hooks:
      - id: update-manifest
        name: update-manifest
        language: system
        entry: pwsh
        args:
          [
            "-NoProfile",
            "-ExecutionPolicy",
            "Bypass",
            "-File",
            "./tools/Hook-UpdateManifest.ps1",
          ]
        pass_filenames: false
        stages: [pre-commit]

      - id: verify-manifest
        name: verify-manifest
        language: system
        entry: pwsh
        args:
          [
            "-NoProfile",
            "-ExecutionPolicy",
            "Bypass",
            "-File",
            "./tools/Hook-VerifyManifest.ps1",
          ]
        pass_filenames: false
        stages: [pre-push]

      - id: update-state-hash
        name: Update state.json hash (PS7)
        language: system
        entry: pwsh
        args:
          [
            "-NoProfile",
            "-ExecutionPolicy",
            "Bypass",
            "-File",
            "tools/Update-StateHash.ps1",
          ]
        pass_filenames: false
        stages: [pre-commit]

      - id: audit-state
        name: Audit state (PS7)
        language: system
        entry: pwsh
        args:
          [
            "-NoProfile",
            "-ExecutionPolicy",
            "Bypass",
            "-File",
            "./tools/Hook-Audit.ps1",
          ]
        pass_filenames: false
        always_run: true
        stages: [pre-push]

  # -------------------------------
  # Guards (push-time)
  # -------------------------------
  - repo: local
    hooks:
      - id: handoff-validate
        name: Validate handoff (push-time, no-write)
        language: system
        entry: pwsh
        args:
          [
            "-NoProfile",
            "-ExecutionPolicy",
            "Bypass",
            "-File",
            "tools/Hook-Handoff.ps1",
            "-Validate",
            "-NonStrict",
          ]
        pass_filenames: false
        always_run: true
        stages: [pre-push]

      - id: risk-governor
        name: Risk Governor (push-time)
        language: system
        entry: pwsh
        args:
          [
            "-NoProfile",
            "-ExecutionPolicy",
            "Bypass",
            "-File",
            "tools/Hook-PrePush-Risk.ps1",
          ]
        pass_filenames: false
        always_run: true
        stages: [pre-push]