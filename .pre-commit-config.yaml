repos:
  # -------------------------------
  # Format / Lint / Text hygiene
  # -------------------------------
  - repo: local
    hooks:
      - id: black-local
        name: black (system)
        entry: python -m black
        language: system
        types_or: [python]
        exclude: ^(src/data/|build/|data/|updates_zip/|site/|docs/|\.ruff_cache/|\.precommit_cache/)
      - id: ruff-local
        name: ruff (system)
        entry: python -m ruff
        args:
          [
            "check",
            "--no-cache",
            "--fix",
            "--exit-non-zero-on-fix",
            "--extend-exclude",
            "\\.bak$|\\.(yml|yaml)$|build/|data/|updates_zip/|site/|docs/|\\.ruff_cache/|\\.precommit_cache/",
          ]
        language: system
        types_or: [python]
        files: ^(src/|tests/)
        exclude: ^(src/data/|build/|data/|updates_zip/|site/|docs/|\.ruff_cache/|\.precommit_cache/)
      - id: eof-fixer-local
        name: end-of-file-fixer (system)
        entry: python -m pre_commit_hooks.end_of_file_fixer
        language: system
        types: [text]
        exclude: >-
          (?x)^(
            updates_zip/|
            data/|
            build/|
            \.precommit_cache/|
            \.ruff_cache/|
            site/|
            docs/|
            ai_lab/audit_report\.md$|
            .*\.parquet$|
            .*\.duckdb$|
            .*\.zip$|
            .*\.gz$|
            .*\.exe$|
            .*\.png$|
            .*\.pdf$
          )
      - id: trailing-ws-local
        name: trailing-whitespace (system)
        entry: python -m pre_commit_hooks.trailing_whitespace_fixer
        language: system
        types: [text]
        exclude: >-
          (?x)^(
            updates_zip/|
            data/|
            build/|
            \.precommit_cache/|
            \.ruff_cache/|
            site/|
            docs/|
            ai_lab/audit_report\.md$|
            .*\.parquet$|
            .*\.duckdb$|
            .*\.zip$|
            .*\.gz$|
            .*\.exe$|
            .*\.png$|
            .*\.pdf$
          )

  # -------------------------------
  # Manifest & metadata
  # -------------------------------
  - repo: local
    hooks:
      - id: update-manifest
        name: update-manifest
        language: system
        entry: pwsh
        args: ["-NoProfile","-ExecutionPolicy","Bypass","-File","./tools/Hook-UpdateManifest.ps1"]
        pass_filenames: false
        stages: [pre-commit]
      - id: verify-manifest
        name: verify-manifest
        language: system
        entry: pwsh
        args: ["-NoProfile","-ExecutionPolicy","Bypass","-File","./tools/Hook-VerifyManifest.ps1"]
        pass_filenames: false
        stages: [pre-push]

  # -------------------------------
  # State hash writer (pre-commit) + audit (pre-push)
  # -------------------------------
  - repo: local
    hooks:
      - id: update-state-hash
        name: Update state.json hash (PS7)
        entry: pwsh -NoProfile -ExecutionPolicy Bypass -File tools/Update-StateHash.ps1
        language: system
        pass_filenames: false
        stages: [pre-commit]
      - id: audit-state
        name: Audit state (PS7)
        entry: pwsh
        args: ["-NoProfile","-ExecutionPolicy","Bypass","-File","./tools/Hook-Audit.ps1"]
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-push]

  # -------------------------------
  # Push-time guards (read-only)
  # -------------------------------
  - repo: local
    hooks:
      - id: handoff-validate
        name: Validate handoff (push-time, no-write)
        entry: pwsh
        args: ["-NoProfile","-ExecutionPolicy","Bypass","-File","tools/Hook-Handoff.ps1","-Validate","-NonStrict"]
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-push]
      - id: risk-governor
        name: Risk Governor (push-time)
        entry: pwsh
        args: ["-NoProfile","-ExecutionPolicy","Bypass","-File","tools/Hook-PrePush-Risk.ps1"]
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-push]
